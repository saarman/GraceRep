
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<html lang="en">
<head>
    <title>Norah's Glossina fuscipes fuscipes spatial analysis notebook</title>
</head>

<H1>Norah's Glossina fuscipes fuscipes spatial analysis notebook</H1><HR>

<H2>Table of Contents:</H2>
<body>
<ul>
    <li><A href="#1">2018-11-14</A>- Task: Run BWA starting from paired fastq files that are the output from STACKs process_radtags.pl</li>
    <li><A href="#2">2018-11-28</A>- See notebook "Gff_ddRAD_notebook_pool_1and2.html"</li>
</ul>
	
<pre>
<HR>
<A NAME="1"></A>2018-11-09</A>- First meeting with Giuseppe: </li>

- Run all from a folder call "scripts" that is backed up on github
- Scripts are in order, and self-contained, so they have the R scripts within them

Initiallizing GitHub repository
- set up the first push
- then the commands are:
 1. git add --all
 2. git commit -m "What this push accomplishes"
 3. git push
 
#get the csv file with the lat/long converted to a spatial data format
- Spatial ecology website: r exercise: understanding ... GLM and MaxEnt
- transform into a point dataframe
- Then convert spatial point dataframe into spatial lines

#final result =
get a set of spatial transects, and then get the mean under the transect for each of the data layers

<HR>
<A NAME="2"></A>2018-10-09</A>- Task: Set up Github on Grace</li>

# From Giuseppe by email
please be sure to follow the same steps of this presentation 
https://research.computing.yale.edu/sites/default/files/files/Version%20Control%20with%20Git.pdf

in the presentation they use bitbucket
but you use git, any way it is the same concept.
Before to push be sure that u run 

git config --global user.name "Your Name"              ....your git user name
git config --global user.email "your.email@yale.edu"   ....your git e-mail address 
git remote add origin ssh...... see slide 25
git push -u origin master ....   see slide 25

#These steps in practice:
ssh -Y nps25@Grace.hpc.yale.edu
srun --pty -p interactive bash
cd /home/nps25/scripts/GraceRep

git config --global user.name "saarman"
git config --global user.email "norah.saarman@yale.edu"
#git init
git remote add origin ssh:git@github.com:saarman/GraceRep.git
git push -u origin master

Then, as I go:
cd /home/fas/caccone/nps25/scripts/GraceRep/
git add --all
git commit -m "adding notebook"
git push -u origin master

<HR>
<A NAME="3"></A>2018-11-28</A>- Task: Create vectors for each pairwise distance needed </li>

#organize directories -- "G" for genetic connectivity, "H" for habitat suitability
mkdir /home/fas/caccone/nps25/scripts/GraceRep/GMODEL
mkdir /home/fas/caccone/nps25/project/GMODEL
mkdir /home/fas/caccone/nps25/scripts/GraceRep/HMODEL
mkdir /home/fas/caccone/nps25/project/HMODEL

#Install packages
srun --pty --x11 -p interactive bash
module load Apps/R/3.3.2-generic

#IN R:
install.packages("sp", repos="https://mirrors.sorengard.com/cran/")
install.packages("spatstat", repos="https://mirrors.sorengard.com/cran/")
install.packages("maptools", repos="https://mirrors.sorengard.com/cran/")
install.packages("raster", repos="https://mirrors.sorengard.com/cran/")

###############################################
#Now create the R Script:
###############################################
cd /home/fas/caccone/nps25/scripts/GraceRep/GMODEL
cat << 'EOF' > 01a.CreateSpatialLines.2018-11-30.R

#R Script: Note that this is also tested and saved locally as "/Users/Norah/Dropbox/Caccone_Aksoy/Glossina-spatial/Gff-Uganda-PopGen/LoadSpatialLines.R"
###############################################
#source(01a.CreateSpatialLines.2018-11-30.R)

#First install packages in interactive mode, then load packages:
library("sp")
library("spatstat")
library("maptools")

#set working directory
setwd("/home/fas/caccone/nps25/project/GMODEL")

#One way to do it is to use the coordinates function:
G.table <- read.table(file="dist_matrix.csv", sep=",", header=T) #-> ... load coordinates and Fst, etc from file 
coordinates(G.table) <- c("long1", "lat1") #->
coordinates1 <- coordinates(G.table) #->
plot(coordinates1)

#Another way to do it is with SpatialPoints
G.table <- read.table(file="dist_matrix.csv", sep=",", header=T)  #->

G.coordinates1 <- G.table[,c(5,3)] #-> ... select the correct collumns 
G.points1 <- SpatialPoints(G.coordinates1)  #-> ... converted into a spatial object
plot(G.points1)

summary(G.points1)
is.projected(G.points1)
crs.geo <- CRS("+init=EPSG:32633 +datum=WGS84") #-> ... add coordinate system
crs.geo
proj4string(G.points1) <- crs.geo  #-> define projection system of our data
summary(G.points1)
is.projected(G.points1)

G.coordinates2 <- G.table[,c(6,4)] #->
G.points2 <- SpatialPoints(G.coordinates2) #->
plot(G.points2)

summary(G.points2)
is.projected(G.points2)
crs.geo <- CRS("+init=EPSG:32633 +datum=WGS84") #-> ... add coordinate system
proj4string(G.points2) <- crs.geo  #-> define projection system of our data
summary(G.points2)
is.projected(G.points2)

#Now a way to create lines from table --
#create dataframes of begin and end coordinates:
G.table <- read.table(file="dist_matrix.csv", sep=",", header=T) #-> ... load coordinates and Fst, etc from file

begin.table <- G.table[,c(5,3)] #->
begin.coord <- begin.table #->
coordinates(begin.coord) <- c("long1", "lat1") #->

end.table <- G.table[,c(6,4)] #->
end.coord <- end.table #->
coordinates(end.coord) <- c("long2", "lat2") #->

p <- psp(begin.table[,1], begin.table[,2], end.table[,1], end.table[,2], owin(range(c(begin.table[,1], end.table[,1])), range(c(begin.table[,2], end.table[,2])))) #->
plot(p)

spatial.p <- as(p, "SpatialLines") #->
crs.geo <- CRS("+init=EPSG:32633 +datum=WGS84") #-> ... add coordinate system
proj4string(spatial.p) <- crs.geo  #-> define projection system of our data
summary(spatial.p)

plot(spatial.p)

save.image("01a.CreateSpatialLines.2018-11-30.Rdata")

#To load the saved image later:
# library("sp")
# library("spatstat")
# library("maptools")
# setwd("/home/fas/caccone/nps25/project/GMODEL")
# load("01a.CreateSpatialLines.2018-11-30.Rdata")
# summary(spatial.p)
# plot(p)
# plot(spatial.p)
###############################################
EOF

###############################################
#Test the R Script:
###############################################
srun --pty --x11 -p interactive bash
module load Apps/R/3.3.2-generic
R

#In R:
source("/gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/01a.CreateSpatialLines.2018-11-30.R")

###############################################
#Now queue the R Script with slurm:
###############################################
cd /home/fas/caccone/nps25/scripts/GraceRep/GMODEL
cat << 'EOF' > 01a.CreateSpatialLines.2018-11-30.R.sh
#!/bin/bash
#SBATCH -p day 
#SBATCH -n 1 -c 1  -N 1  
#SBATCH -t 24:00:00
#SBATCH -o /gpfs/loomis/scratch60/fas/caccone/nps25/stdout/01a.CreateSpatialLines.2018-11-30.R.sh.%J.out
#SBATCH -o /gpfs/loomis/scratch60/fas/caccone/nps25/stderr/01a.CreateSpatialLines.2018-11-30.R.sh.%J.err
#SBATCH --output=01a.CreateSpatialLines.2018-11-30.R.sh.log
#SBATCH --job-name=01a.CreateSpatialLines.2018-11-30.R.sh
#sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/01a.CreateSpatialLines.2018-11-30.R.sh

#export MERIT=/project/fas/sbsc/ga254/grace0.grace.hpc.yale.internal/dataproces/MERIT
#export SCRATCH=/gpfs/scratch60/fas/sbsc/ga254/grace0/dataproces/MERIT_BK
#export RAM=/dev/shm
#export KM=5.00

module load Apps/R/3.3.2-generic

EOF

echo "R --vanilla --no-readline   -q  <<'EOF'" >> 01a.CreateSpatialLines.2018-11-30.R.sh
cat 01a.CreateSpatialLines.2018-11-30.R >> 01a.CreateSpatialLines.2018-11-30.R.sh
echo "EOF" >> 01a.CreateSpatialLines.2018-11-30.R.sh
###############################################
sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/01a.CreateSpatialLines.2018-11-30.R.sh
cat /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/01a.CreateSpatialLines.2018-11-30.R.sh.log


###############################################
#Then take a look at the Rdata output:
###############################################
srun --pty --x11 -p interactive bash
module load Apps/R/3.3.2-generic
R

#In R:
library("sp")
library("spatstat")
library("maptools")
setwd("/home/fas/cacc
load("01a.CreateSpati
summary(spatial.p)
plot(p)
plot(spatial.p)

###############################################
#commit your most recent work:
####
<HR>
<A NAME="4"></A>2019-04-03</A>- Task: Clip layers to Uganda and Kenya</li>
#NOTE: I copied Giuseppe's .bashrc file to my home directory so that the standard modules are loaded every time.

#Following Evie's code https://github.com/evlynpless/MOSQLAND

srun --pty --x11 -p interactive bash
cd /home/fas/caccone/nps25/scripts/GraceRep/GMODEL
mkdir /project/fas/caccone/nps25/RASTERS/UgandaKenyaClips
###########################################
cd /home/fas/caccone/nps25/scripts/GraceRep/
git add --all
git commit -m "01a CreateSpatialLines 2018-11-30 R scripts"
git push -u origin master

mkddir /project/fas/caccone/nps25/RASTERS/UgandaClips
mkdir /project/fas/caccone/nps25/RASTERS/KenyaClips



###############################################
#ARIDITY:  source of data https://github.com/evlynpless/MOSQLAND/blob/master/ARIDITY/sc01_cp_aridity.sh
###############################################
cd /home/fas/caccone/nps25/scripts/GraceRep/GMODEL
cat << 'EOF' > 02a.ClipAridity.2019-04-03.sh
#!/bin/bash
#SBATCH -p day 
##SBATCH -n 1 -c 1  -N 1  
##SBATCH -t 24:00:00
#SBATCH --output=02a.ClipAridity.2019-04-03.sh.log
#SBATCH --job-name=02a.ClipAridity.2019-04-03.sh
##DATA SOURCE: https://github.com/evlynpless/MOSQLAND/tree/master/ARIDITY
##COMMAND: sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02a.ClipAridity.2019-04-03.sh
##LOG FILE: cat /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02a.ClipAridity.2019-04-03.sh.log
INDIR=/project/fas/powell/esp38/dataproces/MOSQLAND/consland/ARIDITY
RASTERNAME=AI_annual

CLIPNAME=UgandaKenyaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 28.6 4.73 42.5 -4.8 $INDIR/${RASTERNAME}.tif  $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif --msknodata -1 -nodata -999
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${CLIPNAME}.asc

CLIPNAME=UgandaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 28.6 4.73 35.4 -1.5 $INDIR/${RASTERNAME}.tif  $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif --msknodata -1 -nodata -999
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${CLIPNAME}.asc

CLIPNAME=KenyaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 33.7 4.73 42.5 -4.8 $INDIR/${RASTERNAME}.tif  $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif --msknodata -1 -nodata -999
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${CLIPNAME}.asc
EOF

sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02a.ClipAridity.2019-04-03.sh

#TO CHECK ON RUN AFTER COMPLETED:
cat /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02a.ClipAridity.2019-04-03.sh.log
ls -l /project/fas/caccone/nps25/RASTERS/*
openev /project/fas/caccone/nps25/RASTERS/UgandaKenyaClips/AI*.tif  #then "control z" and "bg" to leave in background
openev /project/fas/caccone/nps25/RASTERS/UgandaClips/AI*.tif
openev /project/fas/caccone/nps25/RASTERS/KenyaClips/AI*.tif
gdalinfo /project/fas/caccone/nps25/RASTERS/UgandaKenyaClips/AI*.tif
gdalinfo /project/fas/caccone/nps25/RASTERS/UgandaClips/AI*.tif
gdalinfo /project/fas/caccone/nps25/RASTERS/KenyaClips/AI*.tif

###############################################
#Absolute humidity (ABSHUM) "ABS50_res": source of data https://github.com/evlynpless/MOSQLAND/blob/master/ABSHUM/sc01_get_ABSHUM.sh
###############################################
cd /home/fas/caccone/nps25/scripts/GraceRep/GMODEL
cat << 'EOF' > 02b.ClipHumidity.2019-04-03.sh
#!/bin/bash
#SBATCH -p day 
##SBATCH -n 1 -c 1  -N 1  
##SBATCH -t 24:00:00
#SBATCH --output=02b.ClipHumidity.2019-04-03.sh.log
#SBATCH --job-name=02b.ClipHumidity.2019-04-03.sh
##DATA SOURCE: https://github.com/evlynpless/MOSQLAND/tree/master/ABSHUM
##COMMAND: sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02b.ClipHumidity.2019-04-03.sh
##LOG FILE: cat /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02b.ClipHumidity.2019-04-03.sh.log
INDIR=/project/fas/powell/esp38/dataproces/MOSQLAND/consland/ABSHUM
RASTERNAME=ABS50_res

CLIPNAME=UgandaKenyaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 28.6 4.73 42.5 -4.8 $INDIR/${RASTERNAME}.tif  $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif --msknodata 199 --operator ">" -nodata -999
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${CLIPNAME}.asc

CLIPNAME=UgandaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 28.6 4.73 35.4 -1.5 $INDIR/${RASTERNAME}.tif  $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif --msknodata 199 --operator ">" -nodata -999
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${CLIPNAME}.asc

CLIPNAME=KenyaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 33.7 4.73 42.5 -4.8 $INDIR/${RASTERNAME}.tif  $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif --msknodata 199 --operator ">" -nodata -999
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${CLIPNAME}.asc
EOF

sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02b.ClipHumidity.2019-04-03.sh

#TO CHECK ON RUN AFTER COMPLETED:
cat /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02b.ClipHumidity.2019-04-03.sh.log
ls -l /project/fas/caccone/nps25/RASTERS/*
openev /project/fas/caccone/nps25/RASTERS/UgandaKenyaClips/AB*.tif
gdalinfo /project/fas/caccone/nps25/RASTERS/UgandaKenyaClips/AB*.tif


###############################################
#Elevation (MERIT) "altitude_1KMmedian_MERIT": source of data https://github.com/evlynpless/MOSQLAND/blob/master/MERIT/altitude/sc01_cp_altitude.sh
###############################################
cd /home/fas/caccone/nps25/scripts/GraceRep/GMODEL
cat << 'EOF' > 02c.ClipElevation.2019-04-03.sh
#!/bin/bash
#SBATCH -p day 
##SBATCH -n 1 -c 1  -N 1  
##SBATCH -t 24:00:00
#SBATCH --output=02c.ClipElevation.2019-04-03.sh.log
#SBATCH --job-name=02c.ClipElevation.2019-04-03.sh
##DATA SOURCE: https://github.com/evlynpless/MOSQLAND/tree/master/MERIT/altitude
##COMMAND: sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02c.ClipElevation.2019-04-03.sh
##LOG FILE: cat /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02c.ClipElevation.2019-04-03.sh.log
INDIR=/project/fas/powell/esp38/dataproces/MOSQLAND/consland/MERIT/altitude
RASTERNAME=altitude_1KMmedian_MERIT

CLIPNAME=UgandaKenyaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 28.6 4.73 42.5 -4.8 $INDIR/${RASTERNAME}.tif  $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif --msknodata -1 -nodata -999
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${CLIPNAME}.asc

CLIPNAME=UgandaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 28.6 4.73 35.4 -1.5 $INDIR/${RASTERNAME}.tif  $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif --msknodata -1 -nodata -999
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${CLIPNAME}.asc

CLIPNAME=KenyaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 33.7 4.73 42.5 -4.8 $INDIR/${RASTERNAME}.tif  $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif --msknodata -1 -nodata -999
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${CLIPNAME}.asc
EOF

sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02c.ClipElevation.2019-04-03.sh

#TO CHECK ON RUN AFTER COMPLETED:
cat /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02c.ClipElevation.2019-04-03.sh.log
ls -l /project/fas/caccone/nps25/RASTERS/*
openev /project/fas/caccone/nps25/RASTERS/UgandaKenyaClips/alt*.tif
gdalinfo /project/fas/caccone/nps25/RASTERS/UgandaKenyaClips/alt*.tif

###############################################
#Slope (MERIT) "slope_1KMmedian_MERIT": source of data https://github.com/evlynpless/MOSQLAND/blob/master/MERIT/slope/sc01_cp_slope.sh
###############################################
cd /home/fas/caccone/nps25/scripts/GraceRep/GMODEL
cat << 'EOF' > 02d.ClipSlope.2019-04-03.sh
#!/bin/bash
#SBATCH -p day 
##SBATCH -n 1 -c 1  -N 1  
##SBATCH -t 24:00:00
#SBATCH --output=02d.ClipSlope.2019-04-03.sh.log
#SBATCH --job-name=02d.ClipSlope.2019-04-03.sh
##DATA SOURCE: https://github.com/evlynpless/MOSQLAND/tree/master/MERIT/slope
##COMMAND: sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02d.ClipSlope.2019-04-03.sh
##LOG FILE: cat /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02d.ClipSlope.2019-04-03.sh.log
INDIR=/project/fas/powell/esp38/dataproces/MOSQLAND/consland/MERIT/slope
RASTERNAME=slope_1KMmedian_MERIT

CLIPNAME=UgandaKenyaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 28.6 4.73 42.5 -4.8 $INDIR/${RASTERNAME}.tif  $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif --msknodata -1 -nodata -999
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${CLIPNAME}.asc

CLIPNAME=UgandaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 28.6 4.73 35.4 -1.5 $INDIR/${RASTERNAME}.tif  $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif --msknodata -1 -nodata -999
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${CLIPNAME}.asc

CLIPNAME=KenyaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 33.7 4.73 42.5 -4.8 $INDIR/${RASTERNAME}.tif  $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif --msknodata -1 -nodata -999
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${CLIPNAME}.asc
EOF

sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02d.ClipSlope.2019-04-03.sh

#TO CHECK ON RUN AFTER COMPLETED:
cat /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02d.ClipSlope.2019-04-03.sh.log
ls -l /project/fas/caccone/nps25/RASTERS/*
openev /project/fas/caccone/nps25/RASTERS/UgandaKenyaClips/sl*.tif
gdalinfo /project/fas/caccone/nps25/RASTERS/UgandaKenyaClips/sl*.tif

###############################################
#PET = potential evapo-transpiration "pet_mean": source of data https://github.com/evlynpless/MOSQLAND/blob/master/PET/sc01_cp_PET.sh
###############################################
cd /home/fas/caccone/nps25/scripts/GraceRep/GMODEL
cat << 'EOF' > 02e.ClipPET.2019-04-03.sh
#!/bin/bash
#SBATCH -p day 
##SBATCH -n 1 -c 1  -N 1  
##SBATCH -t 24:00:00
#SBATCH --output=02e.ClipPET.2019-04-03.sh.log
#SBATCH --job-name=02e.ClipPET.2019-04-03.sh
##DATA SOURCE: https://github.com/evlynpless/MOSQLAND/tree/master/PET
##COMMAND: sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02e.ClipPET.2019-04-03.sh
##LOG FILE: cat /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02e.ClipPET.2019-04-03.sh.log
INDIR=/project/fas/powell/esp38/dataproces/MOSQLAND/consland/PET
RASTERNAME=pet_mean

CLIPNAME=UgandaKenyaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 28.6 4.73 42.5 -4.8 $INDIR/${RASTERNAME}.tif  $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif --msknodata -16257 -nodata -999
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${CLIPNAME}.asc

CLIPNAME=UgandaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 28.6 4.73 35.4 -1.5 $INDIR/${RASTERNAME}.tif  $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif --msknodata -16257 -nodata -999
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${CLIPNAME}.asc

CLIPNAME=KenyaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 33.7 4.73 42.5 -4.8 $INDIR/${RASTERNAME}.tif  $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif --msknodata -16257 -nodata -999
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${CLIPNAME}.asc
EOF

sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02e.ClipPET.2019-04-03.sh

#TO CHECK ON RUN AFTER COMPLETED:
cat /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02e.ClipPET.2019-04-03.sh.log
ls -l /project/fas/caccone/nps25/RASTERS/*
openev /project/fas/caccone/nps25/RASTERS/UgandaKenyaClips/pet*.tif
gdalinfo /project/fas/caccone/nps25/RASTERS/UgandaKenyaClips/pet*.tif


###############################################
#CHELSA all 19 data types (for 2010?), download script https://github.com/evlynpless/MOSQLAND/blob/master/bioclim/sc01_wget_bioclim.sh
#Bio1 = Annual Mean Temperature
#Bio2 = Mean Diurnal Range (Mean of monthly (max temp - min temp))
#Bio3 = Isothermality (BIO2/BIO7) (* 100)
#Bio4 = Temperature Seasonality (standard deviation *100)
#Bio5 = Max Temperature of Warmest Month
#Bio6 = Min Temperature of Coldest Month
#Bio7 = Temperature Annual Range
#Bio8 = Mean Temperature of Wettest Quarter
#Bio9 = Mean Temperature of Driest Quarter
#Bio10 = Mean Temperature of Warmest Quarter
#Bio11 = Mean Temperature of Coldest Quarter
#Bio12 = Annual Precipitation
#Bio13 = Precipitation of Wettest Month
#Bio14 = Precipitation of Driest Month
#Bio15 = Precipitation Seasonality (Coefficient of Variation)
#Bio16 = Precipitation of Wettest Quarter
#Bio17 = Precipitation of Driest Quarter
#Bio18 = Precipitation of Warmest Quarter
#Bio19 = Precipitation of Coldest Quarter
###############################################
cd /home/fas/caccone/nps25/scripts/GraceRep/GMODEL
cat << 'EOF' > 02f.ClipCHELSA19.2019-04-03.sh
#!/bin/bash
#SBATCH -p day 
##SBATCH -n 1 -c 1  -N 1  
##SBATCH -t 24:00:00
#SBATCH --output=02f.ClipCHELSA19.2019-04-03.sh.log
#SBATCH --job-name=02f.ClipCHELSA19.2019-04-03.sh
##DATA SOURCE: https://github.com/evlynpless/MOSQLAND/tree/master/bioclim
##COMMAND: sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02f.ClipCHELSA19.2019-04-03.sh
##LOG FILE: cat /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02f.ClipCHELSA19.2019-04-03.sh.log
INDIR=/project/fas/powell/esp38/dataproces/MOSQLAND/consland/bioclim
RASTERNAME=CHELSA_bio10

for n in $(seq 1 19 ); do
CLIPNAME=UgandaKenyaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 28.6 4.73 42.5 -4.8 $INDIR/${RASTERNAME}_${n}.tif  $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.tif --msknodata -32768 -nodata -999  
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.asc

CLIPNAME=UgandaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 28.6 4.73 35.4 -1.5 $INDIR/${RASTERNAME}_${n}.tif  $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.tif --msknodata -32768 -nodata -999   
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.asc

CLIPNAME=KenyaClip
OUTDIR=/project/fas/caccone/nps25/RASTERS/${CLIPNAME}s
gdal_translate  -projwin 33.7 4.73 42.5 -4.8 $INDIR/${RASTERNAME}_${n}.tif  $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.tif
pksetmask -i $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.tif -m $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.tif -o $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.tif --msknodata -32768 -nodata -999   
gdal_translate -of AAIGrid $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.tif $OUTDIR/${RASTERNAME}_${n}_${CLIPNAME}.asc
done
EOF

sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02f.ClipCHELSA19.2019-04-03.sh

#TO CHECK ON RUN AFTER COMPLETED:
cat /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/02f.ClipCHELSA19.2019-04-03.sh.log
ls -l /project/fas/caccone/nps25/RASTERS/*
openev /project/fas/caccone/nps25/RASTERS/UgandaKenyaClips/CHELSA_bio10_1_*.tif
gdalinfo /project/fas/caccone/nps25/RASTERS/UgandaKenyaClips/CHELSA_bio10_1_*.tif


#OTHERS FOR FUTURE:
friction = human transportation friction
landcov = the 12 land cover types I mentioned
texture = landscape 'texture' and heterogeneity


###############################################
#commit your most recent work:
###############################################
cd /home/fas/caccone/nps25/scripts/GraceRep/
git add --all
git commit -m "Clipping scripts"
git push -u origin master
#username saarman
#password Seadrag0n!

<HR>
<A NAME="5"></A>2019-04-06</A>- Task: try an iteration of the Random Forest Model</li>

srun --pty -p interactive bash
cd /home/fas/caccone/nps25/scripts/GraceRep/GMODEL


cat << 'EOF' > 03a.GeneticRandomForest.2019-04-06.R

#Based on Evie's code at https://github.com/evlynpless/MOSQLAND/blob/master/RF/sc06_iterativeRF_Florida.R

library("sp")
library("spatstat")
library("maptools")
library("raster")
library("randomForest")
library("gdistance")
library("SDraw")
library("tidyverse")

crs.geo <- CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs") # ... add coordinate system

###############################################
#Plot lines as SpatialLines:
###############################################

#Plot straigt lines for first iteration of RF

G.table <- read.table(file="/project/fas/caccone/nps25/GMODEL/dist_matrix.csv", sep=",", header=T) # ... load coordinates and Fst, etc from file

begin.table <- G.table[,c(5,3)]
begin.coord <- begin.table
coordinates(begin.coord) <- c("long1", "lat1")

end.table <- G.table[,c(6,4)]
end.coord <- end.table
coordinates(end.coord) <- c("long2", "lat2")

p <- psp(begin.table[,1], begin.table[,2], end.table[,1], end.table[,2], owin(range(c(begin.table[,1], end.table[,1])), range(c(begin.table[,2], end.table[,2]))))

spatial.p <- as(p, "SpatialLines")
proj4string(spatial.p) <- crs.geo  # define projection system of our data

print("spatial lines done")

###############################################
#Create raster stack 
###############################################

raster01I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/pet_mean_UgandaClip.tif")
raster02I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/slope_1KMmedian_MERIT_UgandaClip.tif")
raster03I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/AI_annual_UgandaClip.tif")
raster04I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/altitude_1KMmedian_MERIT_UgandaClip.tif")
raster05I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_10_UgandaClip.tif")
raster06I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_11_UgandaClip.tif")
raster07I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_12_UgandaClip.tif")
raster08I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_13_UgandaClip.tif")
raster09I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_14_UgandaClip.tif")
raster10I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_15_UgandaClip.tif")
raster11I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_16_UgandaClip.tif")
raster12I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_17_UgandaClip.tif")
raster13I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_18_UgandaClip.tif")
raster14I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_19_UgandaClip.tif")
raster15I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_1_UgandaClip.tif")
raster16I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_2_UgandaClip.tif")
raster17I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_3_UgandaClip.tif")
raster18I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_4_UgandaClip.tif")
raster19I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_5_UgandaClip.tif")
raster20I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_6_UgandaClip.tif")
raster21I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_7_UgandaClip.tif")
raster22I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_8_UgandaClip.tif")
raster23I = raster("/project/fas/caccone/nps25/RASTERS/UgandaClips/CHELSA_bio10_9_UgandaClip.tif")

raster01 <- raster01I*1
raster02 <- raster02I*1
raster03 <- raster03I*1
raster04 <- raster04I*1
raster05 <- raster05I*1
raster06 <- raster06I*1
raster07 <- raster07I*1
raster08 <- raster08I*1
raster09 <- raster09I*1
raster10 <- raster10I*1
raster11 <- raster11I*1
raster12 <- raster12I*1
raster13 <- raster13I*1
raster14 <- raster14I*1
raster15 <- raster15I*1
raster16 <- raster16I*1
raster17 <- raster17I*1
raster18 <- raster18I*1
raster19 <- raster19I*1
raster20 <- raster20I*1
raster21 <- raster21I*1
raster22 <- raster22I*1
raster23 <- raster23I*1

proj4string(raster01) <- crs.geo
proj4string(raster02) <- crs.geo
proj4string(raster03) <- crs.geo
proj4string(raster04) <- crs.geo
proj4string(raster05) <- crs.geo
proj4string(raster06) <- crs.geo
proj4string(raster07) <- crs.geo
proj4string(raster08) <- crs.geo
proj4string(raster09) <- crs.geo
proj4string(raster10) <- crs.geo
proj4string(raster11) <- crs.geo
proj4string(raster12) <- crs.geo
proj4string(raster13) <- crs.geo
proj4string(raster14) <- crs.geo
proj4string(raster15) <- crs.geo
proj4string(raster16) <- crs.geo
proj4string(raster17) <- crs.geo
proj4string(raster18) <- crs.geo
proj4string(raster19) <- crs.geo
proj4string(raster20) <- crs.geo
proj4string(raster21) <- crs.geo
proj4string(raster22) <- crs.geo
proj4string(raster23) <- crs.geo

env=stack(raster01,
          raster02,
          raster03,
          raster04,
          raster05,
          raster06,
          raster07,
          raster08,
          raster09,
          raster10,
          raster11,
          raster12,
          raster13,
          raster14,
          raster15,
          raster16,
          raster17,
          raster18,
          raster19,
          raster20,
          raster21,
          raster22,
          raster23)

names(env) [1]  <- "pet_mean"
names(env) [2]  <- "slope"
names(env) [3]  <- "AI_annual"
names(env) [4]  <- "altitude"
names(env) [5]  <- "CHELSA_bio10_10"
names(env) [6]  <- "CHELSA_bio10_11"
names(env) [7]  <- "CHELSA_bio10_12"
names(env) [8]  <- "CHELSA_bio10_13"
names(env) [9]  <- "CHELSA_bio10_14"
names(env) [10] <- "CHELSA_bio10_15"
names(env) [11] <- "CHELSA_bio10_16"
names(env) [12] <- "CHELSA_bio10_17"
names(env) [13] <- "CHELSA_bio10_18"
names(env) [14] <- "CHELSA_bio10_19"
names(env) [15] <- "CHELSA_bio10_1"
names(env) [16] <- "CHELSA_bio10_2"
names(env) [17] <- "CHELSA_bio10_3"
names(env) [18] <- "CHELSA_bio10_4"
names(env) [19] <- "CHELSA_bio10_5"
names(env) [20] <- "CHELSA_bio10_6"
names(env) [21] <- "CHELSA_bio10_7"
names(env) [22] <- "CHELSA_bio10_8"
names(env) [23] <- "CHELSA_bio10_9"

print("raster stack done")

########################################
#Calculate mean of straight lines and making initial RF model
#######################################
StraightMean <- raster::extract(env, spatial.p, fun=mean, na.rm=TRUE)

StraightMeanDF <- as.data.frame(StraightMean)

StraightMeanDF$FST_arl <- G.table$FST_arl

#option of trying DPS
#StraightMeanDF$DPS <- G.table$DPS

Straight_RF1 = randomForest(FST_arl ~ pet_mean +
                                      slope +
                                      AI_annual +
                                      altitude +
                                      CHELSA_bio10_10 +
                                      CHELSA_bio10_11 +
                                      CHELSA_bio10_12 +
                                      CHELSA_bio10_13 +
                                      CHELSA_bio10_14 +
                                      CHELSA_bio10_15 +
                                      CHELSA_bio10_16 +
                                      CHELSA_bio10_17 +
                                      CHELSA_bio10_18 +
                                      CHELSA_bio10_19 +
                                      CHELSA_bio10_1 +
                                      CHELSA_bio10_2 +
                                      CHELSA_bio10_3 +
                                      CHELSA_bio10_4 +
                                      CHELSA_bio10_5 +
                                      CHELSA_bio10_6 +
                                      CHELSA_bio10_7 +
                                      CHELSA_bio10_8 +
                                      CHELSA_bio10_9, importance=TRUE, na.action=na.omit, data=StraightMeanDF)

Straight_RF

StraightPred <- predict(env, Straight_RF)

print("first prediction resistance surface done")

pred.cond <- 1/StraightPred #build conductance surface

save.image(file = "/project/fas/caccone/nps25/GMODEL/03a.GeneticRandomForest.2019-04-06.RData")

test = summary(LCP_RF)
EOF


#RUN in sbatch mode:
cat << 'EOF' > 03a.GeneticRandomForest.2019-04-06.sh
#!/bin/bash
#SBATCH -p day 
#SBATCH -n 1 -c 1  -N 1  
#SBATCH -t 24:00:00
#SBATCH --output=03a.GeneticRandomForest.2019-04-06.sh.log
#SBATCH --job-name=03a.GeneticRandomForest.2019-04-06.sh
##COMMAND: sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/03a.GeneticRandomForest.2019-04-06.sh
##LOGFILE: cat /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/03a.GeneticRandomForest.2019-04-06.sh.log

module load Apps/R/3.3.2-generic
module load Rpkgs/RGDAL/1.2-5
R --vanilla -no-readline -q  -f  /home/fas/caccone/nps25/scripts/GraceRep/GMODEL/03a.GeneticRandomForest.2019-04-06.R
EOF

sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/03a.GeneticRandomForest.2019-04-06.sh
#Submitted batch job 29336561

#didn't work for some reason... try again.













</pre>
</html>
