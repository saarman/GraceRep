
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<html lang="en">
<head>
    <title>Norah's Glossina fuscipes fuscipes spatial analysis notebook</title>
</head>

<H1>Norah's Glossina fuscipes fuscipes spatial analysis notebook</H1><HR>

<H2>Table of Contents:</H2>
<body>
<ul>
    <li><A href="#1">2018-11-14</A>- Task: Run BWA starting from paired fastq files that are the output from STACKs process_radtags.pl</li>
    <li><A href="#2">2018-11-28</A>- See notebook "Gff_ddRAD_notebook_pool_1and2.html"</li>
</ul>
	
<pre>
<HR>
<A NAME="1"></A>2018-11-09</A>- First meeting with Giuseppe: </li>

- Run all from a folder call "scripts" that is backed up on github
- Scripts are in order, and self-contained, so they have the R scripts within them

Initiallizing GitHub repository
- set up the first push
- then the commands are:
 1. git add --all
 2. git commit -m "What this push accomplishes"
 3. git push
 
#get the csv file with the lat/long converted to a spatial data format
- Spatial ecology website: r exercise: understanding ... GLM and MaxEnt
- transform into a point dataframe
- Then convert spatial point dataframe into spatial lines

#final result =
get a set of spatial transects, and then get the mean under the transect for each of the data layers

<HR>
<A NAME="2"></A>2018-10-09</A>- Task: Set up Github on Grace</li>

# From Giuseppe by email
please be sure to follow the same steps of this presentation 
https://research.computing.yale.edu/sites/default/files/files/Version%20Control%20with%20Git.pdf

in the presentation they use bitbaket
but you use git, any way it is the same concept.
Before to push be sure that u run 

git config --global user.name "Your Name"              ....your git user name
git config --global user.email "your.email@yale.edu"   ....your git e-mail address 
git remote add origin ssh...... see slide 25
git push -u origin master ....   see slide 25

#These steps in practice:
ssh -Y nps25@Grace.hpc.yale.edu
srun --pty -p interactive bash
cd /home/nps25/scripts/GraceRep

git config --global user.name "saarman"
git config --global user.email "norah.saarman@yale.edu"
git remote add origin ssh:git@github.com:saarman/GraceRep.git
git push -u origin master

Then, as I go:
cd /home/fas/caccone/nps25/scripts/GraceRep/
git add --all
git commit -m "adding notebook"
git push -u origin master

<HR>
<A NAME="3"></A>2018-11-28</A>- Task: Create vectors for each pairwise distance needed </li>

#organize directories -- "G" for genetic connectivity, "H" for habitat suitability
mkdir /home/fas/caccone/nps25/scripts/GraceRep/GMODEL
mkdir /home/fas/caccone/nps25/project/GMODEL
mkdir /home/fas/caccone/nps25/scripts/GraceRep/HMODEL
mkdir /home/fas/caccone/nps25/project/HMODEL

#Start with GMODEL
srun --pty -p interactive bash
cd /home/fas/caccone/nps25/scripts/GraceRep/GMODEL

#Now create the R Script:
###############################################
cat << 'EOF' > 01a.CreateSpatialLines.2018-11-30.R

#R Script: Note that this is also tested and saved locally as "/Users/Norah/Dropbox/Caccone_Aksoy/Glossina-spatial/Gff-Uganda-PopGen/LoadSpatialLines.R"
###############################################
#source(01a.CreateSpatialLines.2018-11-30.R)

#First install packages in interactive mode, then load packages:
library("sp")
library("spatstat")
library("maptools")

#set working directory
setwd("/home/fas/caccone/nps25/project/GMODEL")

#One way to do it is to use the coordinates function:
G.table <- read.table(file="dist_matrix.csv", sep=",", header=T) #-> ... load coordinates and Fst, etc from file 
coordinates(G.table) <- c("long1", "lat1") #->
coordinates1 <- coordinates(G.table) #->
plot(coordinates1)

#Another way to do it is with SpatialPoints
G.table <- read.table(file="dist_matrix.csv", sep=",", header=T)  #->

G.coordinates1 <- G.table[,c(5,3)] #-> ... select the correct collumns 
G.points1 <- SpatialPoints(G.coordinates1)  #-> ... converted into a spatial object
plot(G.points1)

summary(G.points1)
is.projected(G.points1)
crs.geo <- CRS("+init=EPSG:32633 +datum=WGS84") #-> ... add coordinate system
crs.geo
proj4string(G.points1) <- crs.geo  #-> define projection system of our data
summary(G.points1)
is.projected(G.points1)

G.coordinates2 <- G.table[,c(6,4)] #->
G.points2 <- SpatialPoints(G.coordinates2) #->
plot(G.points2)

summary(G.points2)
is.projected(G.points2)
crs.geo <- CRS("+init=EPSG:32633 +datum=WGS84") #-> ... add coordinate system
proj4string(G.points2) <- crs.geo  #-> define projection system of our data
summary(G.points2)
is.projected(G.points2)

#Now a way to create lines from table --
#create dataframes of begin and end coordinates:
G.table <- read.table(file="dist_matrix.csv", sep=",", header=T) #-> ... load coordinates and Fst, etc from file

begin.table <- G.table[,c(5,3)] #->
begin.coord <- begin.table #->
coordinates(begin.coord) <- c("long1", "lat1") #->

end.table <- G.table[,c(6,4)] #->
end.coord <- end.table #->
coordinates(end.coord) <- c("long2", "lat2") #->

p <- psp(begin.table[,1], begin.table[,2], end.table[,1], end.table[,2], owin(range(c(begin.table[,1], end.table[,1])), range(c(begin.table[,2], end.table[,2])))) #->
plot(p)

spatial.p <- as(p, "SpatialLines") #->
crs.geo <- CRS("+init=EPSG:32633 +datum=WGS84") #-> ... add coordinate system
proj4string(spatial.p) <- crs.geo  #-> define projection system of our data
summary(spatial.p)

plot(spatial.p)

save.image("01a.CreateSpatialLines.2018-11-30.Rdata")
# load("01a.CreateSpatialLines.2018-11-30.Rdata")
###############################################
EOF

#Now queue the R Script with slurm:
cd /home/fas/caccone/nps25/scripts/GraceRep/GMODEL
###############################################
cat << 'EOF' > 01a.CreateSpatialLines.2018-11-30.R.sh
#!/bin/bash
#SBATCH -p day 
#SBATCH -n 1 -c 1  -N 1  
#SBATCH -t 24:00:00
#SBATCH -o /gpfs/loomis/scratch60/fas/caccone/nps25/stdout/01a.CreateSpatialLines.2018-11-30.R.sh.%J.out
#SBATCH -o /gpfs/loomis/scratch60/fas/caccone/nps25/stderr/01a.CreateSpatialLines.2018-11-30.R.sh.%J.err
#SBATCH --mail-type=ALL
#SBATCH --mail-user=email
#SBATCH --job-name=01a.CreateSpatialLines.sh
#sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/01a.CreateSpatialLines.2018-11-30.R.sh

#export MERIT=/project/fas/sbsc/ga254/grace0.grace.hpc.yale.internal/dataproces/MERIT
#export SCRATCH=/gpfs/scratch60/fas/sbsc/ga254/grace0/dataproces/MERIT_BK
#export RAM=/dev/shm
#export KM=5.00

module load Apps/R/3.3.2-generic

EOF

echo "R --vanilla --no-readline   -q  <<'EOF'" >> 01a.CreateSpatialLines.2018-11-30.R.sh
cat 01a.CreateSpatialLines.2018-11-30.R >> 01a.CreateSpatialLines.2018-11-30.R.sh
echo "EOF" >> 01a.CreateSpatialLines.2018-11-30.R.sh
###############################################
sbatch /gpfs/loomis/home.grace/fas/caccone/nps25/scripts/GraceRep/GMODEL/01a.CreateSpatialLines.2018-11-30.R.sh

#commit your most recent work:
cd /home/fas/caccone/nps25/scripts/GraceRep/
git add --all
git commit -m "01a CreateSpatialLines 2018-11-30 R scripts"
git push -u origin master

</pre>
</html>
